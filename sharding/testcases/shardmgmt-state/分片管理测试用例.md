# 分片管理测试用例

Chain Manager的主要功能

1. shard启动时，从RootShard中获得配置
2. 初始化Shard ledger，包括rootLedger和shardLedger
3. 从RootShard获得最新的区块
4. 为共识模块提供RootShard区块高度和区块
5. 处理shard中智能合约的Event
6. 维护当前所有shard的配置信息
7. 维护shard与root的eventbus链接

## ChainMgr 初始化

1. 链接到parent shard
2. 从parent shard获取当前shard的配置信息
3. 加载local账本
4. 验证rootLedger有效性
5. 验证shardLedger有效性
6. 从rootLedger中加载所有sib shard信息
7. 从LocalLedger加载本地信息
8. 启动shard中的同步进程, 启动shard共识服务

### case1 启动root shard, 创建shard,并激活
该部分逻辑可以参考 shard管理部分的测试逻辑，该操作只是为下面的测试准备环境
然后保持root shard运行， 关闭child shard进程，然后重启child shard, 测试chainmanager的功能是否正常。

### Case2 重新启动子shard(请确保该子shard处于Activate状态)

#### 步骤
请确保root shart已经启动
子shard的各项配置参数正确
1. 配置正确的shardId启动shard
2. 节点开始同步区块，并执行区块中的交易
3. 节点处理交易触发的shard_activated事件
4. 如果节点参与到分片中，构建分片的config （区分shard config 与 main chain config）
5. 根据root ledger中的信息，初始化shard ledger
6. 启动shard的共识
#### 预期
shard中的同步程序启动，开始同步root shard区块,并执行区块中的交易
待同步到child shard激活的区块，执行到激活交易时，会执行3，4,5,6步骤, shard的数据文件夹会有shard的账本信息(该文件刚开始是没有的),在子shard同步区块期间,子shard的区块高度不会变化，同步到的rootshard的区块高度会变化
子shard启动后，子shard的高度会开始增加。

### Case2 配置错误的shardId 重启shard

#### 步骤
请确保root shart已经启动
shard的各项配置参数正确
1. 配置错误的shardId启动shard

#### 预期
shard启动，同步程序同步区块，但是shard不会激活，此时该shard仅相当于一个区块同步程序
